{"id":"guesthouseosaka-0o7","title":"Add featured image field to house schema","description":"Add optional featured image field to house document that displays as the first image on:\n- MobileHeroImage component\n- ImageBlockGallery component (house page only)\n\nNo changes on gallery page (/[house]/gallery).\n\nSteps:\n- [ ] Add `featuredImage` field to house schema (optional image with i18n alt)\n- [ ] Update GROQ query to include featuredImage\n- [ ] Update MobileHeroImage to use featuredImage if available\n- [ ] Update ImageBlockGallery to prepend featuredImage\n- [ ] Run typegen","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T01:42:35.151328+09:00","updated_at":"2025-12-24T20:11:10.453919+09:00","closed_at":"2025-12-24T20:11:10.453919+09:00","close_reason":"Closed"}
{"id":"guesthouseosaka-101","title":"Update house components to consume Sanity data","description":"Phase B.2 - House Components:\n- Update `house-about.tsx` to use Sanity query\n- Update `house-amenities.tsx` to use Sanity query\n- Update `house-pricing.tsx` to use Sanity query\n- Update `house-location.tsx` to use Sanity query\n- Update `house-building.tsx` to use Sanity query\n\nFiles in: `components/house/`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T20:26:19.769468+09:00","updated_at":"2025-12-21T20:49:45.135162+09:00","closed_at":"2025-12-21T20:49:45.135162+09:00","close_reason":"Closed","dependencies":[{"issue_id":"guesthouseosaka-101","depends_on_id":"guesthouseosaka-b6n","type":"blocks","created_at":"2025-12-21T20:27:32.030145+09:00","created_by":"daemon","metadata":"{}"}]}
{"id":"guesthouseosaka-16g","title":"Refactor gallery query to server-side GROQ","description":"Move gallery image grouping from client-side hook to server-side GROQ query.\n\nCurrent: Client-side hook groups images by category\nTarget: GROQ query returns nested structure grouped by category\n\nReturn structure:\n```typescript\n{\n  category: { key, label, image },\n  images: [{ asset, alt, ... }]\n}[]\n```\n\nSteps:\n- [ ] Create new GROQ query with nested category grouping\n- [ ] Update gallery page to use server-side query\n- [ ] Remove client-side grouping hook if no longer needed\n- [ ] Run typegen","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T01:42:45.919974+09:00","updated_at":"2025-12-23T01:42:45.919974+09:00"}
{"id":"guesthouseosaka-3xt","title":"Fix GROQ query typegen: replace l() helper with inline coalesce","description":"The helper function `l(field)` in `sanity/lib/queries.ts` breaks automatic type generation from `defineQuery()`.\n\n**Problem:**\n- Template literal interpolation with the `l()` helper prevents TypeScript from inferring the correct return types\n- `bun run typegen` cannot statically analyze the query structure\n\n**Solution:**\n- Replace all `${l('fieldName')}` calls with inline `coalesce(fieldName[_key == $locale][0].value, fieldName[_key == \"en\"][0].value)`\n- Remove the `l()` helper function\n- Run `bun run typegen` to verify types are correctly inferred\n\n**Files:**\n- `sanity/lib/queries.ts`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T23:27:53.067732+09:00","updated_at":"2025-12-22T23:30:37.743357+09:00","closed_at":"2025-12-22T23:30:37.743357+09:00","close_reason":"Closed"}
{"id":"guesthouseosaka-5fs","title":"Enable array reordering for Visual Editing","description":"Add Visual Editing support for reordering array items using `useOptimistic` hook pattern (see `hooks/use-optimistic.ts` and `components/collection.tsx`).\n\nArrays to support:\n- [ ] `house.about.highlights` - About section highlights\n- [ ] `house.amenities` - Amenities list (per house, within category groups)\n- [ ] `house.gallery` - Gallery images (within each category)\n- [ ] `house.pricing.notes[].items` - Pricing note items\n\nPattern:\n```typescript\nconst [items, attr] = useOptimistic(data, 'fieldName')\n\u003cdiv data-sanity={attr.list()}\u003e\n  {items?.map(item =\u003e (\n    \u003cdiv key={item._key} data-sanity={attr.item(item._key)} /\u003e\n  ))}\n\u003c/div\u003e\n```\n\nNote: Gallery reordering depends on gallery query refactor (16g).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T01:42:57.959436+09:00","updated_at":"2025-12-23T01:43:18.114405+09:00","closed_at":"2025-12-23T01:43:18.114405+09:00","close_reason":"Duplicate - use bx9 instead"}
{"id":"guesthouseosaka-5lw","title":"Update gallery components to consume Sanity data","description":"Phase B.3 - Gallery Components:\n- Update `house-gallery-client.tsx` to fetch images from Sanity\n- Update `image-block-gallery.tsx` to use Sanity images\n- Remove JSON-based image storage dependency\n\nFiles in: `components/gallery/`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T20:26:26.338751+09:00","updated_at":"2025-12-21T21:05:14.163457+09:00","closed_at":"2025-12-21T21:05:14.163457+09:00","close_reason":"Closed","dependencies":[{"issue_id":"guesthouseosaka-5lw","depends_on_id":"guesthouseosaka-b6n","type":"blocks","created_at":"2025-12-21T20:27:32.198339+09:00","created_by":"daemon","metadata":"{}"}]}
{"id":"guesthouseosaka-b6n","title":"Create GROQ queries for new document types","description":"Phase B.1 - Queries:\n- Create `settingsQuery` for global settings\n- Enhance `houseQuery` with gallery, amenities, pricing, location\n- Create `faqPageQuery` for FAQ page\n- Create `contactPageQuery` for contact page\n\nFile: `sanity/lib/queries.ts`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T20:26:11.983797+09:00","updated_at":"2025-12-21T20:36:36.356126+09:00","closed_at":"2025-12-21T20:36:36.356126+09:00","close_reason":"Closed","dependencies":[{"issue_id":"guesthouseosaka-b6n","depends_on_id":"guesthouseosaka-e9p","type":"blocks","created_at":"2025-12-21T20:27:31.801388+09:00","created_by":"daemon","metadata":"{}"}]}
{"id":"guesthouseosaka-bx9","title":"Enable array reordering for Visual Editing","description":"Add Visual Editing support for reordering array items using `useOptimistic` hook pattern (see `hooks/use-optimistic.ts` and `components/collection.tsx`).\n\nArrays to support:\n- [ ] `house.about.highlights` - About section highlights\n- [ ] `house.amenities` - Amenities list (per house, within category groups)\n- [ ] `house.gallery` - Gallery images (within each category)\n- [ ] `house.pricing.notes[].items` - Pricing note items\n\nPattern:\n```typescript\nconst [items, attr] = useOptimistic(data, 'fieldName')\n\u003cdiv data-sanity={attr.list()}\u003e\n  {items?.map(item =\u003e (\n    \u003cdiv key={item._key} data-sanity={attr.item(item._key)} /\u003e\n  ))}\n\u003c/div\u003e\n```\n\nNote: Gallery reordering depends on gallery query refactor (16g).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T01:43:06.634007+09:00","updated_at":"2025-12-24T21:56:24.163584+09:00","closed_at":"2025-12-24T21:56:24.163584+09:00","close_reason":"Closed","dependencies":[{"issue_id":"guesthouseosaka-bx9","depends_on_id":"guesthouseosaka-16g","type":"blocks","created_at":"2025-12-23T01:43:06.635648+09:00","created_by":"daemon"}]}
{"id":"guesthouseosaka-d86","title":"Migrate SEO and JSON-LD to use Sanity data","description":"Update SEO metadata and JSON-LD structured data to use Sanity instead of hardcoded values and next-intl.\n\n## Currently using Sanity ‚úÖ\n- House page JSON-LD: title, description, phone, address, building (rooms)\n\n## Still using next-intl or hardcoded ‚ùå\n\n| Data | Current Source | Should Use |\n|------|----------------|------------|\n| Site name | `t('manifest.name')` | `settings.brandName` |\n| Site description | `t('manifest.description')` | Missing - add to settings |\n| Organization legal name | Hardcoded | `settings.companyName` |\n| Organization email | Hardcoded | Missing - add to settings |\n| Social links (sameAs) | Hardcoded `urls.socials` | `settings.socialLinks` |\n| House SEO title/summary | `getHouseLabel()` next-intl | `house.title`, `house.description` |\n| House phone (org JSON-LD) | `getHousePhoneLabel()` next-intl | `house.phone` |\n\n## Missing fields to add to Settings schema\n- [ ] `email` - Contact email for Organization schema\n- [ ] `siteDescription` - Site meta description (i18n)\n- [ ] `keywords` (optional) - SEO keywords array\n\n## Steps\n- [ ] Add missing fields to Settings schema\n- [ ] Update settingsQuery to include new fields\n- [ ] Update root layout to fetch settings and use for JSON-LD\n- [ ] Update root layout generateMetadata to use settings\n- [ ] Update house layout generateMetadata to use Sanity data\n- [ ] Remove `getHouseLabel()` and `getHousePhoneLabel()` helpers\n- [ ] Run typegen","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T01:54:19.734589+09:00","updated_at":"2025-12-23T01:54:19.734589+09:00"}
{"id":"guesthouseosaka-dcq","title":"Seed taxonomy data in Sanity","description":"Phase C.1 - Seed Taxonomies:\n- Create 7 gallery categories (room, common-spaces, facilities, etc.)\n- Create 7 amenity categories (internet_climate, kitchen_dining, etc.)\n- Create ~25 amenities with icons and category references\n\nUse Sanity MCP tools for content operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T20:26:34.778507+09:00","updated_at":"2025-12-22T23:16:28.359179+09:00","closed_at":"2025-12-22T23:16:28.359179+09:00","close_reason":"Closed","dependencies":[{"issue_id":"guesthouseosaka-dcq","depends_on_id":"guesthouseosaka-e9p","type":"blocks","created_at":"2025-12-21T20:27:32.368099+09:00","created_by":"daemon","metadata":"{}"}]}
{"id":"guesthouseosaka-e9p","title":"Deploy Sanity schema and run typegen","description":"Phase A completion:\n- Run `bunx sanity schema deploy` to deploy schema to Content Lake\n- Run `bun run typegen` to regenerate TypeScript types\n- Verify types are generated correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T20:26:04.087434+09:00","updated_at":"2025-12-21T20:30:56.00111+09:00","closed_at":"2025-12-21T20:30:56.00111+09:00","close_reason":"Closed"}
{"id":"guesthouseosaka-huw","title":"Migrate house content to Sanity","description":"Phase C.2 - House Content Migration\n\n‚úÖ COMPLETED:\n- Created seed script: `scripts/seed-house-content.ts`\n- Seeded all 3 houses (apple, lemon, orange) with:\n  - Caption (i18n: en, ja, fr)\n  - Building facts (rooms, floors, startingPrice)\n  - About section (description + highlights)\n  - Location (highlight, address, coordinates, stations, nearby)\n  - Pricing (rows + notes)\n  - Phone numbers (domestic + international)\n- Components already consume Sanity data (task 101)\n- Visual Editing support added for number fields (building facts)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T20:26:42.90329+09:00","updated_at":"2025-12-23T01:18:54.176284+09:00","closed_at":"2025-12-23T01:18:54.176284+09:00","close_reason":"Closed","dependencies":[{"issue_id":"guesthouseosaka-huw","depends_on_id":"guesthouseosaka-dcq","type":"blocks","created_at":"2025-12-21T20:27:32.536859+09:00","created_by":"daemon","metadata":"{}"},{"issue_id":"guesthouseosaka-huw","depends_on_id":"guesthouseosaka-101","type":"blocks","created_at":"2025-12-21T20:27:32.711682+09:00","created_by":"daemon","metadata":"{}"},{"issue_id":"guesthouseosaka-huw","depends_on_id":"guesthouseosaka-5lw","type":"blocks","created_at":"2025-12-21T20:27:32.877774+09:00","created_by":"daemon","metadata":"{}"}]}
{"id":"guesthouseosaka-je9","title":"Migrate FAQ and settings content to Sanity","description":"Phase C.3 - FAQ \u0026 Settings Migration\n\n‚úÖ COMPLETED:\n- Seed script exists: `scripts/seed-singleton-content.ts`\n- FAQ items seeded to Sanity (faqPage document)\n- Contact types seeded (contactPage document)\n- Site settings seeded (settings document)\n\n‚è≥ TODO - Update front-end to consume Sanity data:\n- [ ] FAQ page: Replace `useTranslations('FAQAccordion')` with Sanity query\n- [ ] Contact page: Fetch contact types from Sanity\n- [ ] Footer/layout: Fetch settings (company name, social links) from Sanity\n\nüìù NOTES:\n- `floors-and-rooms`: Already fetches building data from house documents\n- `extra-costs`: Uses dedicated component with static data (not migrated)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T20:26:48.925149+09:00","updated_at":"2025-12-23T01:19:06.124803+09:00","dependencies":[{"issue_id":"guesthouseosaka-je9","depends_on_id":"guesthouseosaka-dcq","type":"blocks","created_at":"2025-12-21T20:27:33.050451+09:00","created_by":"daemon","metadata":"{}"}]}
{"id":"guesthouseosaka-u32","title":"Cleanup: Remove redundant next-intl content","description":"Phase C.4 - Cleanup redundant next-intl content\n\nAfter front-end components consume Sanity data, remove unused translation keys from `messages/*.json`:\n\n- [ ] Remove `FAQAccordion` namespace (except keys used by non-migrated items)\n- [ ] Remove `ContactNavigation` namespace\n- [ ] Remove house-related content that's now in Sanity\n- [ ] Remove settings-related keys (company name, etc.)\n- [ ] Run `bun run knip` to detect any remaining unused exports\n\nBlocked by: je9 (front-end must consume Sanity data first)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T20:26:58.328787+09:00","updated_at":"2025-12-23T01:19:17.759181+09:00","dependencies":[{"issue_id":"guesthouseosaka-u32","depends_on_id":"guesthouseosaka-huw","type":"blocks","created_at":"2025-12-21T20:27:33.21937+09:00","created_by":"daemon","metadata":"{}"},{"issue_id":"guesthouseosaka-u32","depends_on_id":"guesthouseosaka-je9","type":"blocks","created_at":"2025-12-21T20:27:33.387106+09:00","created_by":"daemon","metadata":"{}"},{"issue_id":"guesthouseosaka-u32","depends_on_id":"guesthouseosaka-d86","type":"blocks","created_at":"2025-12-23T01:54:56.134586+09:00","created_by":"daemon"}]}
